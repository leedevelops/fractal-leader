<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hebrew Leadership Journey</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #111; color: #fff; }
        #landing, #assessment, #levelView { display: none; }
        #landing.active, #assessment.active, #levelView.active { display: block; }
        #matrix { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        button { padding: 15px 30px; margin: 10px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #218838; }
        .card { width: 200px; height: 300px; background: #fff; color: #000; margin: 10px; display: inline-block; position: relative; transition: transform 0.6s; transform-style: preserve-3d; }
        .card.flipped { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; }
        .card-back { transform: rotateY(180deg); background: #f0f0f0; flex-direction: column; }
        canvas { border: 2px solid #333; background: #fff; }
        #nextLevel { display: none; }
    </style>
</head>
<body>
    <canvas id="matrix" width="800" height="600"></canvas>
    <div id="landing" class="active">
        <h1>Hebrew Leadership Journey</h1>
        <p>Matrix-style Hebrew letters flow...</p>
        <button onclick="startJourney()">Genesis Go</button>
    </div>
    <div id="assessment">
        <h2>Assessment</h2>
        <p>Discover your leadership style!</p>
        <form id="assessForm">
            <label><input type="radio" name="q1" value="leader"> Leader</label>
            <label><input type="radio" name="q1" value="pioneer"> Pioneer</label>
            <label><input type="radio" name="q1" value="organizer"> Organizer</label><br>
            <button type="submit">Submit</button>
        </form>
        <button onclick="showMatrixMap()">View Matrix Map</button>
    </div>
    <div id="levelView">
        <h2>Level <span id="currentLevel">1</span></h2>
        <div id="cardDeck"></div>
        <button id="nextLevel">Next Level</button>
    </div>
    <script>
        // Matrix background
        const matrixCanvas = document.getElementById('matrix');
        const mCtx = matrixCanvas.getContext('2d');
        matrixCanvas.height = window.innerHeight;
        matrixCanvas.width = window.innerWidth;
        const hebrewLetters = 'אבגדהוזחטיכלמנסעפצקרשת';
        const fontSize = 20;
        const columns = matrixCanvas.width / fontSize;
        const drops = Array(Math.floor(columns)).fill(0);

        function drawMatrix() {
            mCtx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            mCtx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height);
            mCtx.fillStyle = '#0f0';
            mCtx.font = fontSize + 'px monospace';
            drops.forEach((y, i) => {
                const text = hebrewLetters.charAt(Math.floor(Math.random() * hebrewLetters.length));
                const x = i * fontSize;
                mCtx.fillText(text, x, y);
                if (y > matrixCanvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i] += fontSize;
            });
        }
        setInterval(drawMatrix, 50);

        // Navigation
        const landing = document.getElementById('landing');
        const assessment = document.getElementById('assessment');
        const levelView = document.getElementById('levelView');
        const assessForm = document.getElementById('assessForm');
        const currentLevelSpan = document.getElementById('currentLevel');
        const cardDeck = document.getElementById('cardDeck');
        const nextLevelBtn = document.getElementById('nextLevel');

        function startJourney() {
            landing.classList.remove('active');
            assessment.classList.add('active');
        }

        function showMatrixMap() {
            alert('Matrix Map: A visual guide to the 27 levels!');
        }

        // Assessment logic
        assessForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const userType = document.querySelector('input[name="q1"]:checked')?.value;
            if (userType) {
                localStorage.setItem('userType', userType);
                localStorage.setItem('currentLevel', 1);
                assessment.classList.remove('active');
                levelView.classList.add('active');
                loadLevel(1);
            } else {
                alert('Please select a type!');
            }
        });

        // Level and card logic
        const levels = Array.from({ length: 27 }, (_, i) => ({
            id: i + 1,
            book: Math.floor(i / 5) + 1,
            letter: hebrewLetters[i % hebrewLetters.length],
            categories: [
                { name: 'Overview', items: Array(4).fill('Content') },
                { name: 'Challenges', items: Array(4).fill('Puzzle') },
                { name: 'Tools', items: Array(4).fill('Quiz') },
                { name: 'Wrap-Up', items: Array(3).fill('Summary') }
            ]
        }));

        function loadLevel(level) {
            currentLevelSpan.textContent = level;
            cardDeck.innerHTML = '';
            const current = levels[level - 1];
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-front">${current.letter}</div>
                <div class="card-back">
                    <canvas id="traceCanvas" width="150" height="150"></canvas>
                    <div id="categoryTabs"></div>
                </div>
            `;
            cardDeck.appendChild(card);
            card.addEventListener('click', () => {
                card.classList.toggle('flipped');
                if (card.classList.contains('flipped')) loadCanvas(current.letter);
            });
            loadTabs(current.categories);
            nextLevelBtn.style.display = level === 27 ? 'none' : 'block';
        }

        function loadTabs(categories) {
            const tabsDiv = document.getElementById('categoryTabs');
            tabsDiv.innerHTML = categories.map((cat, i) => `
                <button onclick="loadCategory(${i})">${cat.name}</button>
            `).join('');
        }

        function loadCategory(index) {
            const level = parseInt(currentLevelSpan.textContent);
            const items = levels[level - 1].categories[index].items;
            alert(`Category ${index + 1}: ${items.join(', ')}`);
            // TODO: Replace with quiz/puzzle UI
        }

        // Canvas for letter tracing
        function loadCanvas(letter) {
            const canvas = document.getElementById('traceCanvas');
            const ctx = canvas.getContext('2d');
            const dots = getDotsForLetter(letter);
            let currentDot = 0;
            let drawing = false;
            let path = [];

            function drawDots() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                dots.forEach(dot => {
                    ctx.beginPath();
                    ctx.arc(dot.x, dot.y, 5, 0, 2 * Math.PI);
                    ctx.fillStyle = dot.num <= currentDot + 1 ? 'green' : 'gray';
                    ctx.fill();
                    ctx.fillText(dot.num, dot.x + 10, dot.y);
                });
                ctx.beginPath();
                for (let i = 1; i < path.length; i++) {
                    ctx.moveTo(path[i-1].x, path[i-1].y);
                    ctx.lineTo(path[i].x, path[i].y);
                }
                ctx.strokeStyle = 'blue';
                ctx.stroke();
            }

            function isNearDot(x, y, dot) {
                return Math.sqrt((x - dot.x) ** 2 + (y - dot.y) ** 2) < 15;
            }

            canvas.addEventListener('mousedown', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                if (currentDot < dots.length && isNearDot(x, y, dots[currentDot])) {
                    drawing = true;
                    path.push({ x, y });
                }
            });

            canvas.addEventListener('mousemove', (e) => {
                if (drawing) {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    if (isNearDot(x, y, dots[currentDot])) {
                        path.push(dots[currentDot]);
                        currentDot++;
                        if (currentDot === dots.length) {
                            drawing = false;
                            nextLevelBtn.style.display = 'block';
                        }
                        drawDots();
                    }
                }
            });

            canvas.addEventListener('mouseup', () => {
                drawing = false;
            });

            drawDots();
        }

        // Simplified dot coordinates for Hebrew letters (example for Aleph)
        function getDotsForLetter(letter) {
            // Placeholder: Expand for other letters
            if (letter === 'א') {
                return [
                    { x: 50, y: 50, num: 1 },
                    { x: 75, y: 100, num: 2 },
                    { x: 100, y: 150, num: 3 },
                    { x: 125, y: 100, num: 4 },
                    { x: 150, y: 50, num: 5 }
                ];
            }
            return [{ x: 50, y: 50, num: 1 }]; // Fallback
        }

        nextLevelBtn.addEventListener('click', () => {
            let level = parseInt(localStorage.getItem('currentLevel')) || 1;
            if (level < 27) {
                level++;
                localStorage.setItem('currentLevel', level);
                loadLevel(level);
            }
        });

        // Load saved progress
        const savedLevel = localStorage.getItem('currentLevel');
        if (savedLevel) {
            landing.classList.remove('active');
            levelView.classList.add('active');
            loadLevel(parseInt(savedLevel));
        }
    </script>
</body>
</html>